COMP       = gfortran
CFLAGS     = $(LDFLAGS) -c 
LDFLAGS    = -O3 -s -ffree-line-length-none
SOURCES-PS = celula.f90 CONTROLA.F90 ENSAMBLO.F90 inicio.f90 lectura.f90 \
	poisson.f90 campo.f90 finalice.f90 lbcg.f90 leemalla.f90 salidas.f90
SOURCES-M  = def_constantes.f90 def_solver.f90 def_variables.f90
OBJECTS1   = $(SOURCES-PS:.f90=.o)
OBJECTS2   = $(SOURCES-PS:.F90=.o)
OBJECTS3   = $(SOURCES-M:.f90=.mod)
OBJECTS4   = $(SOURCES-M:.f90=.mod)
OBJECTS    = $(OBJECTS3) $(OBJECTS4) $(OBJECTS1) $(OBJECTS2) 
EXECUTABLE = celula

all: $(SOURCES) $(EXECUTABLE)

run: all
	./$(EXECUTABLE)

$(EXECUTABLE): $(OBJECTS)
	$(COMP) $(LDFLAGS) $(OBJECTS) -o $@
	
%.o : %.mod	
	
%.mod: %.f90
	$(COMP) $(CFLAGS) $< -o $@
	
.f90.mod:
	$(COMP) $(CFLAGS) $< -o $@
	
%.o: %.f90
	$(COMP) $(CFLAGS) $< -o $@

clean: 
	rm -f *.o *.mod main
